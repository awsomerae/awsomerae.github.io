<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에이치엘비셀 업무관리시스템</title>
    <link rel="icon" href="https://raw.githubusercontent.com/awsomerae/awsomerae.github.io/8149709b3b43c279ecf3d21314be3cb51f3db290/newgate.png" type="image/png">
    <style>
        /* project newgate , prod RAE */
        /* Version 1.0 */

        /* 1. 기본 및 폰트 */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f6f8fa; /* GitHub 페이지 배경색 */
            color: #24292e; /* 기본 텍스트 색상 */
            font-size: 14px; /* 기본 폰트 크기 조정 */
        }

        *, input, select, button, textarea, table, th, td {
            font-size: inherit; /* body의 폰트 크기 상속 */
            box-sizing: border-box; /* 모든 요소에 box-sizing 적용 */
        }

        h2, h3 { /* 제목 스타일 */
            font-weight: 600;
            color: #24292e;
        }
        h2 { font-size: 2em; margin-bottom: 16px; color: #0366d6;}
        h3 { font-size: 1.25em; margin-bottom: 12px; }


        /* 2. 컨테이너 */
        .container {
            max-width: none;
            width: 96vw;
            margin-left: 2vw;
            margin-right: 2vw;
            background-color: #ffffff;
            padding: 24px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
        }

        .page { display: none; } /* 페이지 기본 숨김 */

        /* 3. 헤더 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 16px;
            border-bottom: 1px solid #e1e4e8;
            margin-bottom: 24px;
            flex-wrap: wrap; /* 헤더 내용이 많아지면 줄바꿈 */
        }
        .header h2 {
            margin-top: 0; /* h2의 기본 margin 제거 */
            margin-bottom: 4px;
        }
        .header .user-info {
            font-size: 0.85em;
            color: #586069;
            margin-top: 4px;
        }
        .header .buttons {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap; /* 버튼 줄바꿈 */
            justify-content: flex-end;
        }

        /* 4. 버튼 스타일 */
        .header .buttons button,
        .popup-content .button-group button,
        /* .checkin-entry-form .save-button, */ /* checkin-entry-form이 팝업으로 대체됨 */
        .dashboard-link .nav-button,
        .save-button-small, .delete-button-small {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid rgba(27,31,35,0.15);
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            line-height: 20px;
            white-space: nowrap; /* 버튼 텍스트 줄바꿈 방지 */
        }

        .header .buttons .nav-button, .dashboard-link .nav-button {
            background-color: #fafbfc;
            color: #24292e;
            border-color: rgba(27,31,35,0.15);
        }
        .header .buttons .nav-button:hover, .dashboard-link .nav-button:hover {
            background-color: #f3f4f6;
            border-color: rgba(27,31,35,0.2);
        }

        .header .buttons .action-button {
            background-color: #2ea44f;
            color: white;
            border-color: rgba(27,31,35,0.15);
        }
        .header .buttons .action-button:hover {
            background-color: #2c974b;
        }

        .header .buttons .refresh-button {
            background-color: #0366d6;
            color: white;
            border-color: rgba(27,31,35,0.15);
        }
        .header .buttons .refresh-button:hover {
            background-color: #005cc5;
        }

        .header .buttons .delete-button,
        .popup-content .button-group .delete-button {
            background-color: #d73a49;
            color: white;
            border-color: rgba(27,31,35,0.15);
        }
        .header .buttons .delete-button:hover,
        .popup-content .button-group .delete-button:hover {
            background-color: #cb2431;
        }

        .popup-content .button-group .save-button {
            background-color: #2ea44f; color: white; border-color: rgba(27,31,35,0.15);
        }
        .popup-content .button-group .save-button:hover { background-color: #2c974b; }

        .popup-content .button-group .cancel-button {
            background-color: #fafbfc; color: #d73a49; border-color: rgba(27,31,35,0.15);
        }
        .popup-content .button-group .cancel-button:hover { background-color: #f3f4f6; }


        /* 5. 테이블 스타일 */
        .data-section {
            min-height: 300px; /* 최소 높이 설정, 내용 없을 때 대비 */
            height: calc(100vh - 260px); /* 헤더, 패딩, 마진 등을 고려한 높이 */
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th, td {
            border: 1px solid #e1e4e8;
            padding: 10px 12px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        th {
            background-color: #f6f8fa;
            font-weight: 600;
            padding-top: 12px;
            padding-bottom: 12px;
            position: sticky; /* 테이블 헤더 고정 */
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) {
            background-color: #f6f8fa;
        }
        tr:hover {
            background-color: #f1f8ff;
            cursor: pointer;
        }
        td.numeric { text-align: right; }

        /* 6. 팝업 스타일 */
        .popup-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* GitHub 스타일 배경 어둡게 */
            justify-content: center; align-items: center; z-index: 1000;
        }
        .popup-content {
            background-color: #fff;
            padding: 24px;
            border-radius: 6px;
            box-shadow: 0 8px 24px rgba(149,157,165,0.2); /* GitHub 스타일의 그림자 */
            max-width: 700px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }
        .popup-content h3 {
            margin-top: 0;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 12px;
            font-size: 1.4em;
        }
        .popup-content form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .popup-content label {
            font-weight: 600;
            font-size: 0.95em;
            margin-bottom: 6px;
            display: block;
        }
        .popup-content input, .popup-content select, .popup-content textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            background-color: #f6f8fa;
        }
        .popup-content input:focus, .popup-content select:focus, .popup-content textarea:focus {
            border-color: #0366d6;
            background-color: #fff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(3,102,214,0.3);
        }
        .popup-content .button-group {
            grid-column: 1 / -1;
            text-align: right;
            margin-top: 15px;
            display: flex; /* 버튼 그룹 정렬 */
            justify-content: flex-end;
            gap: 8px;
        }
        .popup-instructions {
            grid-column: 1 / -1;
            font-size: 0.9em;
            color: #586069;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e1e4e8;
        }


        /* 7. 로그인 페이지 */
        #loginPage {
            display: none; /* 초기 none, JS로 flex 제어 */
            flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; background-color: #f6f8fa;
            padding: 20px;
        }
        #loginPage .login-box {
            background-color: #fff;
            padding: 32px;
            border-radius: 6px;
            border: 1px solid #d1d5da;
            text-align: center;
            width: 100%;
            max-width: 360px;
        }
        #loginPage h2 {
            font-size: 1.75em;
            margin-bottom: 24px;
            margin-top: 0;
        }
        #loginPage input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            background-color: #f6f8fa;
            margin-bottom: 16px;
        }
        #loginPage input:focus {
            border-color: #0366d6;
            background-color: #fff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(3,102,214,0.3);
        }
        #loginPage button {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            border: 1px solid rgba(27,31,35,0.15);
        }
        #loginPage .login-button {
            background-color: #2ea44f; color: white;
        }
        #loginPage .login-button:hover { background-color: #2c974b; }
        #loginPage .new-account-button {
            background-color: #0366d6; color: white; margin-top: 12px;
        }
        #loginPage .new-account-button:hover { background-color: #005cc5; }


        /* 증빙 업로드 버튼 그룹 스타일 조정 */
        .upload-button-group {
            display: flex;
            align-items: center; /* 버튼과 인풋 수직 정렬 */
            gap: 8px;
        }
        .upload-button-group input[type="text"] {
            flex-grow: 1;
            margin-bottom: 0 !important;
        }
        .upload-button-group button {
            padding: 8px 12px;
            background-color: #0366d6; color: white;
            font-size: 13px;
            height: 38px; /* 인풋 높이와 비슷하게 */
            flex-shrink: 0;
        }
        .upload-button-group button:hover { background-color: #005cc5; }


        /* 관리자 페이지 선택된 행 */
        #adminPage .data-section table tr.selected,
        #accountTable tbody tr.selected { /* ID 직접 지정 */
            background-color: #f1f8ff !important; /* !important로 우선순위 */
        }
        #adminPage .data-section table tr.selected td,
        #accountTable tbody tr.selected td {
            font-weight: 500;
        }
        /* 계정 테이블 컬럼 너비 */
        #accountTable { table-layout: fixed; width: 100%; }
        #accountTable th:nth-child(1), #accountTable td:nth-child(1) { width: 120px; } /* ID */
        #accountTable th:nth-child(2), #accountTable td:nth-child(2) { width: 120px; } /* password */
        #accountTable th:nth-child(3), #accountTable td:nth-child(3) { width: 100px; } /* 소속 */
        #accountTable th:nth-child(4), #accountTable td:nth-child(4) { width: 100px; } /* 성명 */
        #accountTable th:nth-child(5), #accountTable td:nth-child(5) { width: 100px; } /* 직급 */


        /* Check-in Page specific styles (팝업으로 대체되면서 일부 불필요해질 수 있음) */
        /* .checkin-entry-form 관련 스타일은 checkInPage 본문에 폼이 없을 경우 불필요 */

        .delete-button-small {
            padding: 4px 8px;
            font-size: 12px;
            background-color: transparent;
            color: #d73a49;
            border: 1px solid transparent;
        }
        .delete-button-small:hover {
            background-color: #fff5f5;
            border-color: #d73a49;
            color: #cb2431;
        }

        #checkInTable td { max-width: 250px; }
        #checkInTable td:nth-child(4), #checkInTable th:nth-child(4), /* 내용 */
        #checkInTable td:nth-child(6), #checkInTable th:nth-child(6) { /* 피드백 */
            white-space: normal;
            word-break: break-word;
            min-width: 150px;
        }

        /* Feedback Page specific styles (현재 HTML에는 없음) */
        /* #evalUserListTable tbody tr:hover { background-color: #f1f8ff; }
        .feedback-content-cell {
            max-width: 300px;
            white-space: normal !important;
            word-break: break-word;
        }
        #userCheckInsTableForFeedback textarea {
            width: 100%;
            padding: 5px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            background-color: #f6f8fa;
        }
        #userCheckInsTableForFeedback textarea:focus {
            background-color: #fff;
            border-color: #0366d6;
        } */
        .save-button-small { /* 피드백 저장 버튼 등에 사용될 수 있음 */
            padding: 5px 10px;
            font-size: 0.9em;
            background-color: #2ea44f;
            color: white;
        }
        .save-button-small:hover { background-color: #2c974b; }

        /* Dashboard Page specific styles */
        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        .dashboard-row {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        .dashboard-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
            flex: 1 1 0;
            min-width: 0;
        }
        .dashboard-section h3 {
            margin-top: 0;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 10px;
            font-size: 1.2em;
        }
        .dashboard-section table {
            font-size: 0.9em;
            width: 100%;
            table-layout: fixed;
        }
        .dashboard-link {
            margin-top: 15px;
            text-align: right;
        }
        .dashboard-link .nav-button {
            font-size: 0.9em;
            padding: 6px 12px;
        }
        #dashboardCheckInTable th:nth-child(1), #dashboardCheckInTable td:nth-child(1) { width: 15%; } /* 일자 */
        #dashboardCheckInTable th:nth-child(2), #dashboardCheckInTable td:nth-child(2) { width: 35%; } /* 내용 */
        #dashboardCheckInTable th:nth-child(3), #dashboardCheckInTable td:nth-child(3) { width: 15%; } /* 상태 */
        #dashboardCheckInTable th:nth-child(4), #dashboardCheckInTable td:nth-child(4) { width: 35%; } /* 피드백 */

        #dashboardPurchaseTable th:nth-child(1), #dashboardPurchaseTable td:nth-child(1) { width: 25%; } /* 계산서일자 */
        #dashboardPurchaseTable th:nth-child(2), #dashboardPurchaseTable td:nth-child(2) { width: 45%; } /* 물품명 */
        #dashboardPurchaseTable th:nth-child(3), #dashboardPurchaseTable td:nth-child(3) { width: 30%; } /* 합계 */

        #dashboardExpenseTable th:nth-child(1), #dashboardExpenseTable td:nth-child(1) { width: 25%; } /* 일자 */
        #dashboardExpenseTable th:nth-child(2), #dashboardExpenseTable td:nth-child(2) { width: 45%; } /* 적요 */
        #dashboardExpenseTable th:nth-child(3), #dashboardExpenseTable td:nth-child(3) { width: 30%; } /* 합계 */

        /* Loading spinner */
        .loader {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-top: -25px;
            margin-left: -25px;
            z-index: 1001; /* Above modal overlay */
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Check-in 팝업 스타일 */
        #checkInPopup .popup-content, #editCheckInPopup .popup-content {
            max-width: 700px;
            width: 90%;
        }
        #checkInPopup form, #editCheckInPopup form {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2열 그리드 */
            gap: 16px;
        }
        #checkInPopup .form-group.full-width, #editCheckInPopup .form-group.full-width {
            grid-column: 1 / -1; /* 내용 필드는 전체 너비 사용 */
        }
        #checkInPopup textarea, #editCheckInPopup textarea {
            min-height: 90px;
            resize: vertical;
        }
        #checkInPopup .button-group, #editCheckInPopup .button-group {
            grid-column: 1 / -1;
            text-align: right;
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

    </style>
</head>
<body>
    <div class="loader" id="loader" style="display:none;"></div>

    <script>
        // === Loader 관련 함수 ===
        function showLoader() {
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'block';
        }
        function hideLoader() {
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'none';
        }

        const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyk5qTvZzF1cqNveAFMQ8f31v8S89PgaV9s504v7XsS3LasBeuNNr8jf4oSzKGdF0zP/exec'; // <-- ⭐ 실제 웹 앱 URL로 교체하세요 ⭐
        let loggedInUser = null;
        let currentEditingRowIndex = null;
        // let selectedAccountId = null; // 관리자 페이지에서 선택된 계정 ID (단일 클릭 시) -> currentEditingAccountData.ID로 대체 가능성 검토 또는 유지
        let currentEditingAccountData = null; // 계정 수정 시 사용

        const ACCOUNT_HEADERS = ['ID', 'password', '소속', '성명', '직급'];
        const PURCHASE_HEADERS = ['담당자', '구매구분', '프로젝트', '국책과제여부', '구매품의번호', '구매품의명', '품의서링크', '구매처', '물품명', '단가', '수량', '공급가', '부가세', '합계', '세금계산서일자', '비고', '증빙'];
        const EXPENSE_HEADERS = ['담당자', '일자', '비목', '사용처', '적요', '공급가', '부가세', '합계', '비고' , '증빙'];
        const CHECKIN_HEADERS = ['작성자', '일자', '구분', '내용', '상태', '피드백']; // '작성자ID' -> '작성자'로 변경 (서버 응답 필드명과 일치 가정)

        // let usersToEvaluateGlobal = []; // 피드백 페이지 관련 (현재 HTML에 없음)
        // let selectedUserForFeedbackId = null; // 피드백 페이지 관련

        function formatNumberWithCommas(number) {
            const numStr = String(number).replace(/,/g, '');
            if (numStr === null || numStr === undefined || numStr === '' || isNaN(parseFloat(numStr))) {
                return '';
            }
            try {
                return parseFloat(numStr).toLocaleString('en-US');
            } catch (e) {
                console.error("Error formatting number:", number, e);
                return String(number); // 오류 발생 시 원본 값 반환 (문자열로)
            }
        }
        
        function formatDateToYYYYMMDD(dateValue) {
            if (!dateValue) return '';
            try {
                const dateObj = new Date(dateValue);
                if (isNaN(dateObj.getTime())) return String(dateValue); // 유효하지 않은 날짜면 원본 반환

                // UTC 기준으로 년, 월, 일 추출 (타임존 문제 회피)
                const year = dateObj.getUTCFullYear();
                const month = String(dateObj.getUTCMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getUTCDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            } catch (e) {
                console.error("Error formatting date:", dateValue, e);
                return String(dateValue);
            }
        }


        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            const pageElement = document.getElementById(pageId);

            if (pageId === 'loginPage') {
                if(pageElement) pageElement.style.display = 'flex';
            } else {
                if(pageElement) pageElement.style.display = 'block';
            }

            if (loggedInUser) {
                updateUserInfo();

                if (pageId === 'purchasePage') loadPurchaseData();
                else if (pageId === 'expensePage') loadExpenseData();
                else if (pageId === 'adminPage' && loggedInUser.isAdmin) loadAccountData();
                else if (pageId === 'checkInPage') {
                    loadCheckInData();
                    // Check-in 페이지 직접 입력 폼 관련 코드는 팝업으로 대체되었으므로 주석 처리 또는 삭제
                    // document.getElementById('checkInEntryAuthor').value = loggedInUser.name;
                    // document.getElementById('checkInEntryDate').valueAsDate = new Date();
                    // clearCheckInInputs(false); // 이 함수도 필요 없을 수 있음
                }
                // else if (pageId === 'feedbackPage' && (loggedInUser.isEvaluator || loggedInUser.isAdmin)) {
                    // loadUsersToEvaluate(); // 피드백 페이지 관련
                    // document.getElementById('userCheckInsForFeedbackSection').style.display = 'none';
                // }
                else if (pageId === 'dashboardPage') {
                    loadDashboardData();
                }
            }
        }
        
        function updateUserInfo() {
            if (loggedInUser) {
                const userInfoSpans = document.querySelectorAll('.user-info span'); // ID 대신 클래스로 전체 선택
                const userInfoText = `사용자: ${loggedInUser.affiliation || '소속없음'} ${loggedInUser.name} ${loggedInUser.position || '직급없음'}`;
                userInfoSpans.forEach(span => {
                    span.textContent = userInfoText;
                });

                const adminNavButtons = document.querySelectorAll('[id^="navButtonAdminPage"]'); // 관리자 버튼 전체
                adminNavButtons.forEach(button => {
                    button.style.display = loggedInUser.isAdmin ? 'inline-block' : 'none';
                });

                const feedbackNavButtons = document.querySelectorAll('[id^="navButtonFeedbackPage"]'); // 피드백 버튼 전체
                const canShowFeedbackButton = loggedInUser.isAdmin || loggedInUser.isEvaluator; // isEvaluator는 로그인 응답에 포함되어야 함
                feedbackNavButtons.forEach(button => {
                    button.style.display = canShowFeedbackButton ? 'inline-block' : 'none';
                });

            } else {
                document.querySelectorAll('.user-info span').forEach(s => s.textContent = '');
                document.querySelectorAll('[id^="navButtonAdminPage"]').forEach(b => b.style.display = 'none');
                document.querySelectorAll('[id^="navButtonFeedbackPage"]').forEach(b => b.style.display = 'none');
            }
        }


        function showPopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) popup.style.display = 'flex';
        }

        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.style.display = 'none';
                const form = popup.querySelector('form');
                if (form) form.reset();
            }
        }

        function showInfoPopup(message) {
            const msgElem = document.getElementById('infoPopupMessage');
            if(msgElem) msgElem.innerText = message;
            showPopup('infoPopup');
        }

        async function sendRequest(action, payload = {}) {
            const requestOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain;charset=utf-8', },
                body: JSON.stringify({ 
                    action: action, 
                    payload: payload, 
                    user: loggedInUser ? { ID: loggedInUser.ID, name: loggedInUser.name, isAdmin: loggedInUser.isAdmin, affiliation: loggedInUser.affiliation, position: loggedInUser.position } : null 
                })
            };
            try {
                showLoader(); // 요청 시작 시 로더 표시
                const response = await fetch(APPS_SCRIPT_WEB_APP_URL, requestOptions);
                hideLoader(); // 응답 수신 후 로더 숨김
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('HTTP error', response.status, errorText);
                    return { status: 'error', message: `HTTP 오류: ${response.status}. ${errorText}` };
                }
                const data = await response.json();
                console.log('API Response:', action, data);
                return data;
            } catch (error) {
                hideLoader(); // 오류 발생 시 로더 숨김
                console.error('API Request Error:', action, error);
                return { status: 'error', message: `네트워크 오류: ${error.message}. URL 또는 배포를 확인하세요.` };
            }
        }

        async function handleLogin() {
            const idInput = document.getElementById('loginId');
            const passwordInput = document.getElementById('loginPassword');
            if(!idInput || !passwordInput) return;

            const id = idInput.value;
            const password = passwordInput.value;

            if (!id || !password) {
                showInfoPopup('ID와 비밀번호를 입력해주세요.');
                return;
            }
            const response = await sendRequest('login', { id: id, password: password });

            if (response.status === 'success' && response.user) {
                loggedInUser = response.user;
                console.log('로그인 성공:', loggedInUser);
                updateUserInfo();
                showPage('dashboardPage'); // 로그인 성공 시 대시보드로 이동
                idInput.value = '';
                passwordInput.value = '';
            } else {
                showInfoPopup(response.message || '로그인 실패');
            }
        }
        
        // 엔터키 로그인 (로그인 페이지에서만 동작하도록 개선 가능)
        document.getElementById('loginPassword')?.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if(document.getElementById('loginPage').style.display === 'flex') { // 로그인 페이지 활성화 시
                    handleLogin();
                }
            }
        });


        function openNewAccountPopup() {
            const form = document.querySelector('#newUserPopup form');
            if(form) form.reset();
            showPopup('newUserPopup');
        }


        async function handleCreateNewAccount() {
            const idInput = document.getElementById('newAccountId');
            const passwordInput = document.getElementById('newUserPassword');
            const affiliationInput = document.getElementById('newUserAffiliation');
            const nameInput = document.getElementById('newUserName');
            const positionInput = document.getElementById('newUserPosition');

            if(!idInput || !passwordInput || !affiliationInput || !nameInput || !positionInput) return;

            const id = idInput.value;
            const password = passwordInput.value;
            const affiliation = affiliationInput.value;
            const name = nameInput.value;
            const position = positionInput.value;

            if (!id || !password || !name) {
                showInfoPopup('ID, 비밀번호, 성명은 필수 입력 항목입니다.');
                return;
            }
            const payload = { ID: id, password: password, 소속: affiliation, 성명: name, 직급: position };

            const response = await sendRequest('createUser', payload);
            if (response.status === 'success') {
                showInfoPopup(response.message || "계정이 성공적으로 생성되었습니다.");
                closePopup('newUserPopup');
                if (loggedInUser && loggedInUser.isAdmin && document.getElementById('adminPage')?.style.display === 'block') {
                    const okButton = document.getElementById('infoPopupOkButton');
                    if(okButton) okButton.onclick = () => { closePopup('infoPopup'); loadAccountData(); };
                }
            } else {
                showInfoPopup(response.message || "계정 생성에 실패했습니다.");
            }
        }

        function displayDataInTable(data, tableId, headers, editable = false, onRowDoubleClickCallback = null) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            if (!tableBody) return;
            tableBody.innerHTML = '';

            if (!data || data.length === 0) {
                const row = tableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = headers.length;
                cell.innerText = '데이터가 없습니다.';
                cell.style.textAlign = 'center';
                return;
            }
            
            const numericCols = (tableId === 'purchaseTable')
                ? ['단가', '수량', '공급가', '부가세', '합계']
                : (tableId === 'expenseTable')
                    ? ['공급가', '부가세', '합계']
                    : [];

            data.forEach(rowData => {
                const row = tableBody.insertRow();
                if(rowData.rowIndex !== undefined) row.dataset.rowIndex = rowData.rowIndex; // 0도 유효한 값
                if(rowData.ID) row.dataset.userId = rowData.ID; 
                if(rowData.EntryID) row.dataset.entryId = rowData.EntryID;

                headers.forEach((header) => {
                    const cell = row.insertCell();
                    let cellValue = rowData[header] === undefined || rowData[header] === null ? '' : rowData[header];

                    if (numericCols.includes(header) && cellValue !== '') {
                        cellValue = formatNumberWithCommas(cellValue);
                        cell.classList.add('numeric');
                    } else if ((header === '세금계산서일자' || header === '일자') && cellValue) {
                        cellValue = formatDateToYYYYMMDD(cellValue);
                    }

                    if (header === '품의서링크' || (header === '증빙' && tableId !== 'checkInTable')) {
                        if (cellValue) {
                            const link = document.createElement('a');
                            link.href = cellValue;
                            link.innerText = '링크';
                            link.target = '_blank';
                            link.onclick = function(event) { event.stopPropagation(); };
                            cell.innerHTML = '';
                            cell.appendChild(link);
                        } else {
                            cell.innerText = '-';
                        }
                    } else {
                        cell.innerText = cellValue;
                    }
                });

                if (editable && onRowDoubleClickCallback && (tableId === 'purchaseTable' || tableId === 'expenseTable')) {
                     row.ondblclick = () => onRowDoubleClickCallback(tableId, rowData);
                } else if (tableId === 'accountTable' && onRowDoubleClickCallback) {
                     row.ondblclick = () => onRowDoubleClickCallback(rowData);
                     row.onclick = (event) => handleAccountRowClick(event);
                } else if (tableId === 'checkInTable' && onRowDoubleClickCallback) { 
                    row.ondblclick = () => onRowDoubleClickCallback(rowData); // openEditCheckInPopup
                }
            });
        }
        
        async function loadPurchaseData() {
            if (!loggedInUser) return;
            const response = await sendRequest('getPurchaseData'); // userName, isAdmin은 sendRequest에서 자동 포함
            if (response.status === 'success') {
                displayDataInTable(response.data, 'purchaseTable', PURCHASE_HEADERS, true, openEditPopup);
            } else {
                showInfoPopup('구매 관리 데이터를 불러오는데 실패했습니다: ' + (response.message || '알 수 없는 오류'));
                displayDataInTable([], 'purchaseTable', PURCHASE_HEADERS, true, openEditPopup);
            }
        }

        async function loadExpenseData() {
            if (!loggedInUser) return;
            const response = await sendRequest('getExpenseData');
            if (response.status === 'success') {
                displayDataInTable(response.data, 'expenseTable', EXPENSE_HEADERS, true, openEditPopup);
            } else {
                showInfoPopup('개인 경비 데이터를 불러오는데 실패했습니다: ' + (response.message || '알 수 없는 오류'));
                displayDataInTable([], 'expenseTable', EXPENSE_HEADERS, true, openEditPopup);
            }
        }
        
        async function loadAccountData() {
            if (!loggedInUser || !loggedInUser.isAdmin) return;
            const response = await sendRequest('getAccounts');
            if (response.status === 'success') {
                displayDataInTable(response.accounts, 'accountTable', ACCOUNT_HEADERS, false, openEditAccountPopup);
            } else {
                showInfoPopup('계정 정보를 불러오는데 실패했습니다: ' + (response.message || '알 수 없는 오류'));
                displayDataInTable([], 'accountTable', ACCOUNT_HEADERS, false, openEditAccountPopup);
            }
        }

        function setupSumCalculation(popupId, supplyPriceName, vatName, sumName) {
            const popup = document.getElementById(popupId);
            if (!popup) return;
            const form = popup.querySelector('form');
            if (!form) return;

            const supplyPriceInput = form.elements[supplyPriceName];
            const vatInput = form.elements[vatName];
            const sumInput = form.elements[sumName];

            function calculateSum() {
                if (!supplyPriceInput || !vatInput || !sumInput) return;
                const supplyPrice = parseFloat(String(supplyPriceInput.value).replace(/,/g, '')) || 0;
                const vat = parseFloat(String(vatInput.value).replace(/,/g, '')) || 0;
                sumInput.value = formatNumberWithCommas(supplyPrice + vat);
            }

            if (supplyPriceInput && vatInput && sumInput) {
                [supplyPriceInput, vatInput].forEach(input => {
                    input.addEventListener('input', calculateSum);
                    input.addEventListener('blur', () => {
                        if (input.value) input.value = formatNumberWithCommas(input.value);
                        calculateSum(); // blur 시에도 합계 재계산
                    });
                });
                if (supplyPriceInput.value || vatInput.value) calculateSum(); // 초기 로드 시 계산
            }
        }

        function openNewEntryPopup(type) {
            currentEditingRowIndex = null; // 신규 작성이므로 이전 편집 인덱스 초기화
            const popupId = type === 'purchase' ? 'newPurchasePopup' : 'newExpensePopup';
            const popup = document.getElementById(popupId);
            if (!popup) return;
            const form = popup.querySelector('form');
            if (!form) return;
            form.reset();

            if (loggedInUser && form.elements['담당자']) {
                form.elements['담당자'].value = loggedInUser.name;
                form.elements['담당자'].readOnly = true;
            }
            if (type === 'purchase' && form.elements['세금계산서일자']) {
                 form.elements['세금계산서일자'].value = formatDateToYYYYMMDD(new Date());
            } else if (type === 'expense' && form.elements['일자']) {
                 form.elements['일자'].value = formatDateToYYYYMMDD(new Date());
            }


            setupSumCalculation(popupId, '공급가', '부가세', '합계');
            showPopup(popupId);
        }

        function openEditPopup(tableId, rowData) {
            currentEditingRowIndex = rowData.rowIndex; // 수정할 행의 인덱스 저장
            let popupId, headers;

            if (tableId === 'purchaseTable') {
                popupId = 'editPurchasePopup';
                headers = PURCHASE_HEADERS;
            } else if (tableId === 'expenseTable') {
                popupId = 'editExpensePopup';
                headers = EXPENSE_HEADERS;
            } else { return; }

            const form = document.querySelector(`#${popupId} form`);
            if (!form) return;
            form.reset();

            headers.forEach(header => {
                const input = form.elements[header];
                if (input) {
                    let value = rowData[header] === undefined || rowData[header] === null ? '' : rowData[header];
                    if ((header === '세금계산서일자' || header === '일자') && value) {
                        input.value = formatDateToYYYYMMDD(value);
                    } else if (['단가', '수량', '공급가', '부가세', '합계'].includes(header)) {
                        input.value = formatNumberWithCommas(value);
                    } else {
                        input.value = value;
                    }
                    if (header === '담당자') input.readOnly = true;
                }
            });
            setupSumCalculation(popupId, '공급가', '부가세', '합계');
            showPopup(popupId);
        }
        
        async function handleSaveData(type) {
            const isEditMode = currentEditingRowIndex !== null && currentEditingRowIndex !== undefined;
            const popupId = type === 'purchase' 
                ? (isEditMode ? 'editPurchasePopup' : 'newPurchasePopup') 
                : (isEditMode ? 'editExpensePopup' : 'newExpensePopup');
            const form = document.querySelector(`#${popupId} form`);
            if (!form) return;

            const dataObject = {};
            const headers = type === 'purchase' ? PURCHASE_HEADERS : EXPENSE_HEADERS;
            let isValid = true;

            headers.forEach(header => {
                const input = form.elements[header];
                if (input) {
                    if (['단가', '수량', '공급가', '부가세', '합계'].includes(header)) {
                         dataObject[header] = String(input.value).replace(/,/g, '');
                    } else {
                        dataObject[header] = input.value;
                    }
                } else if (header === '담당자' && loggedInUser && !isEditMode) {
                    dataObject[header] = loggedInUser.name;
                }
            });
            
            if (type === 'purchase' && (!dataObject['구매품의명'] || !dataObject['물품명'])) {
                showInfoPopup('구매품의명과 물품명은 필수 입력 항목입니다.');
                isValid = false;
            }
            if (type === 'expense' && (!dataObject['일자'] || !dataObject['적요'])) {
                 showInfoPopup('일자와 적요는 필수 입력 항목입니다.');
                isValid = false;
            }
            if(!isValid) return;

            const action = type === 'purchase'
                ? (isEditMode ? 'updatePurchase' : 'createPurchase')
                : (isEditMode ? 'updateExpense' : 'createExpense');
            
            const payload = isEditMode 
                ? { rowIndex: currentEditingRowIndex, data: dataObject } 
                : { data: dataObject };

            const response = await sendRequest(action, payload);

            if (response.status === 'success') {
                showInfoPopup(response.message || "데이터가 성공적으로 저장되었습니다.");
                closePopup(popupId);
                const reloadFunction = type === 'purchase' ? loadPurchaseData : loadExpenseData;
                const okButton = document.getElementById('infoPopupOkButton');
                if(okButton) okButton.onclick = () => { closePopup('infoPopup'); reloadFunction(); };
            } else {
                showInfoPopup(response.message || "데이터 저장에 실패했습니다.");
            }
            currentEditingRowIndex = null; // 작업 후 초기화
        }

        function handleDeleteConfirmation(type) {
            if (currentEditingRowIndex === null || currentEditingRowIndex === undefined) {
                showInfoPopup('삭제할 항목이 선택되지 않았습니다. 목록에서 더블클릭하여 선택해주세요.');
                return;
            }
            const confirmMsg = document.getElementById('confirmDeleteMessage');
            if(confirmMsg) confirmMsg.innerText = '정말 이 항목을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.';
            
            const okButton = document.getElementById('confirmDeleteOkButton');
            if(okButton) okButton.onclick = () => handleDeleteData(type);
            
            const cancelButton = document.getElementById('confirmDeleteCancelButton');
            if(cancelButton) cancelButton.onclick = () => closePopup('confirmDeletePopup');
            
            showPopup('confirmDeletePopup');
        }

        async function handleDeleteData(type) {
            if (currentEditingRowIndex === null || currentEditingRowIndex === undefined) {
                showInfoPopup('삭제할 항목이 없습니다.');
                closePopup('confirmDeletePopup');
                return;
            }
            closePopup('confirmDeletePopup');
            const action = type === 'purchase' ? 'deletePurchase' : 'deleteExpense';
            const response = await sendRequest(action, { rowIndex: currentEditingRowIndex });

            if (response.status === 'success') {
                showInfoPopup(response.message || "항목이 성공적으로 삭제되었습니다.");
                const reloadFunction = type === 'purchase' ? loadPurchaseData : loadExpenseData;
                const okButton = document.getElementById('infoPopupOkButton');
                if(okButton) okButton.onclick = () => { closePopup('infoPopup'); reloadFunction(); };
                
                const editPopupId = type === 'purchase' ? 'editPurchasePopup' : 'editExpensePopup';
                closePopup(editPopupId); 
            } else {
                showInfoPopup(response.message || "항목 삭제에 실패했습니다.");
            }
            currentEditingRowIndex = null; // 작업 후 초기화
        }

        function handleAccountRowClick(event) {
            document.querySelectorAll('#accountTable tbody tr').forEach(row => row.classList.remove('selected'));
            const clickedRow = event.target.closest('tr');
            if (clickedRow) {
                clickedRow.classList.add('selected');
                // selectedAccountId = clickedRow.dataset.userId; // 이 변수 대신 currentEditingAccountData 사용 고려
                // console.log('Selected Account ID (single click):', selectedAccountId);
            }
        }
        
        function openEditAccountPopup(rowData) {
            currentEditingAccountData = rowData; // 수정할 계정 데이터 저장
            // currentEditingRowIndex = rowData.rowIndex; // 계정 정보는 rowIndex가 없을 수 있음. ID로 식별

            const form = document.querySelector('#editAccountPopup form');
            if(!form) return;
            form.reset();
            form.elements['ID'].value = rowData.ID || '';
            form.elements['password'].value = ''; // 비밀번호는 항상 비워둠
            form.elements['password'].placeholder = '새 비밀번호 (변경 시에만 입력)';
            form.elements['소속'].value = rowData.소속 || '';
            form.elements['성명'].value = rowData.성명 || '';
            form.elements['직급'].value = rowData.직급 || '';

            showPopup('editAccountPopup');
        }

        async function handleSaveAccountData() {
            if (!currentEditingAccountData || !currentEditingAccountData.ID) {
                showInfoPopup('수정할 계정 정보가 없습니다.');
                return;
            }
            const form = document.querySelector('#editAccountPopup form');
            if(!form) return;

            if (!form.elements['성명'].value) {
                showInfoPopup('성명은 필수 입력 항목입니다.');
                return;
            }
            const accountData = {
                소속: form.elements['소속'].value,
                성명: form.elements['성명'].value,
                직급: form.elements['직급'].value
            };

            const newPassword = form.elements['password'].value;
            if (newPassword && newPassword.trim().length > 0) { // 공백만 있는 비밀번호 방지
                accountData.password = newPassword;
            }
            const payload = {
                userId: currentEditingAccountData.ID, // 수정 대상 ID
                accountData: accountData // 수정할 데이터
            };
            const response = await sendRequest('updateAccount', payload);
            if (response.status === 'success') {
                showInfoPopup(response.message || "계정 정보가 성공적으로 수정되었습니다.");
                closePopup('editAccountPopup');
                const okButton = document.getElementById('infoPopupOkButton');
                if(okButton) okButton.onclick = () => { closePopup('infoPopup'); loadAccountData(); };
            } else {
                showInfoPopup(response.message || "계정 정보 수정에 실패했습니다.");
            }
            currentEditingAccountData = null; // 작업 후 초기화
        }

        function handleDeleteConfirmationForAccount() {
            if (!currentEditingAccountData || !currentEditingAccountData.ID) {
                showInfoPopup('삭제할 계정이 선택되지 않았습니다. 목록에서 더블클릭하여 선택해주세요.');
                return;
            }
            if (loggedInUser && loggedInUser.ID === currentEditingAccountData.ID) {
                showInfoPopup('자기 자신의 계정은 삭제할 수 없습니다.');
                return;
            }
            const confirmMsg = document.getElementById('confirmDeleteMessage');
            if(confirmMsg) confirmMsg.innerText = `ID "${currentEditingAccountData.ID}" 계정을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.`;
            
            const okButton = document.getElementById('confirmDeleteOkButton');
            if(okButton) okButton.onclick = executeAccountDeletion;
            
            const cancelButton = document.getElementById('confirmDeleteCancelButton');
            if(cancelButton) cancelButton.onclick = () => closePopup('confirmDeletePopup');

            showPopup('confirmDeletePopup');
        }

        async function executeAccountDeletion() {
            if (!currentEditingAccountData || !currentEditingAccountData.ID) { 
                closePopup('confirmDeletePopup'); return; 
            }
            if (loggedInUser && loggedInUser.ID === currentEditingAccountData.ID) { 
                closePopup('confirmDeletePopup'); return; 
            }
            closePopup('confirmDeletePopup');
            const response = await sendRequest('deleteAccount', { userId: currentEditingAccountData.ID });
            if (response.status === 'success') {
                showInfoPopup(response.message || "계정이 성공적으로 삭제되었습니다.");
                closePopup('editAccountPopup'); // 수정 팝업도 닫기
                const okButton = document.getElementById('infoPopupOkButton');
                if(okButton) okButton.onclick = () => { closePopup('infoPopup'); loadAccountData(); };
            } else {
                showInfoPopup(response.message || "계정 삭제에 실패했습니다.");
            }
            currentEditingAccountData = null; // 작업 후 초기화
        }

        function openUploadFolder(folderUrl) {
            window.open(folderUrl, '_blank', 'width=800,height=600,resizable=yes,scrollbars=yes');
        }
        
        // === Check-in Page Functions ===
        async function loadCheckInData() {
            if (!loggedInUser) return;
            const response = await sendRequest('getCheckInData'); // 페이로드에 사용자 정보 불필요 (sendRequest에서 처리)
            if (response.status === 'success' && response.data) {
                // 서버에서 정렬해서 보내주거나, 클라이언트에서 정렬
                const sortedData = response.data.sort((a, b) => new Date(b.일자) - new Date(a.일자));
                displayDataInTable(sortedData, 'checkInTable', CHECKIN_HEADERS, false, openEditCheckInPopup);
            } else {
                showInfoPopup('Check-in 데이터를 불러오는데 실패했습니다: ' + (response.message || '알 수 없는 오류'));
                displayDataInTable([], 'checkInTable', CHECKIN_HEADERS, false, openEditCheckInPopup);
            }
        }

        // clearCheckInInputs 함수는 checkInPage의 기본 입력 폼이 사라졌으므로, 필요 시 팝업용으로 수정하거나 삭제
        /*
        function clearCheckInInputs(clearAuthor = true) {
            // 이 함수는 더 이상 사용되지 않을 수 있습니다.
            // const authorInput = document.getElementById('checkInEntryAuthor');
            // if (clearAuthor && authorInput) authorInput.value = '';
            // ...
        }
        */

        // handleSaveCheckIn 함수는 checkInPage의 기본 입력 폼이 사라졌으므로, 필요 시 팝업용으로 수정하거나 삭제
        /*
        async function handleSaveCheckIn() {
            // 이 함수는 더 이상 사용되지 않을 수 있습니다.
            // const author = document.getElementById('checkInEntryAuthor').value;
            // ...
        }
        */
        
        // === Dashboard Page Functions ===
        // loadDashboardData 와 displayDashboardSummary 함수는 HTML 내 <script> 태그로 옮겨져 개선됨. 여기서는 제거.

        window.onload = () => {
            showPage('loginPage');
        };

        function openCheckInPopup() {
            const form = document.querySelector('#checkInPopupForm');
            if(!form) return;
            form.reset();

            if(loggedInUser) form.elements['작성자'].value = loggedInUser.name;
            form.elements['일자'].value = formatDateToYYYYMMDD(new Date());
            form.elements['구분'].value = '업무';
            form.elements['상태'].value = 'Okay';
            form.elements['내용'].value = '';
            showPopup('checkInPopup');
        }

        async function handleSaveCheckInFromPopup() {
            const form = document.querySelector('#checkInPopupForm');
            if(!form) return;

            const author = form.elements['작성자'].value;
            const date = form.elements['일자'].value;
            const category = form.elements['구분'].value;
            const content = form.elements['내용'].value;
            const status = form.elements['상태'].value;

            if (!date || !content) {
                showInfoPopup('일자와 내용은 필수 입력 항목입니다.');
                return;
            }
            // EntryID는 서버에서 생성, 피드백은 초기엔 비어있음
            const checkInData = { 작성자: author, 일자: date, 구분: category, 내용: content, 상태: status, 피드백: '' };
            const response = await sendRequest('createCheckIn', { data: checkInData });

            if (response.status === 'success') {
                showInfoPopup(response.message || 'Check-in이 저장되었습니다.');
                closePopup('checkInPopup');
                if(document.getElementById('checkInPage').style.display === 'block') loadCheckInData(); // 체크인 페이지 보고 있을 때만 새로고침
                if(document.getElementById('dashboardPage').style.display === 'block') loadDashboardData(); // 대시보드 보고 있을 때 새로고침
            } else {
                showInfoPopup('Check-in 저장 실패: ' + (response.message || '알 수 없는 오류'));
            }
        }

        function openEditCheckInPopup(rowData) {
            const form = document.querySelector('#editCheckInPopupForm');
            if(!form) return;
            form.reset();

            form.elements['작성자'].value = rowData['작성자'] || '';
            form.elements['일자'].value = formatDateToYYYYMMDD(rowData['일자']);
            form.elements['구분'].value = rowData['구분'] || '업무';
            form.elements['상태'].value = rowData['상태'] || 'Okay';
            form.elements['내용'].value = rowData['내용'] || '';
            
            // 수정 대상 식별자 저장 (EntryID가 더 확실한 식별자)
            window.editingCheckInEntryID = rowData.EntryID; 
            window.editingCheckInRowIndex = rowData.rowIndex; // rowIndex도 여전히 사용될 수 있음 (서버 로직에 따라)
            showPopup('editCheckInPopup');
        }

        async function handleSaveCheckInFromEditPopup() {
            const form = document.querySelector('#editCheckInPopupForm');
            if(!form) return;

            const author = form.elements['작성자'].value; // 작성자는 수정 불가하도록 readonly 처리됨
            const date = form.elements['일자'].value;
            const category = form.elements['구분'].value;
            const content = form.elements['내용'].value;
            const status = form.elements['상태'].value;

            if (!date || !content) {
                showInfoPopup('일자와 내용은 필수 입력 항목입니다.');
                return;
            }
            // 수정 시에는 기존 피드백 값을 유지해야 할 수 있으나, 현재 폼에는 피드백 필드가 없음.
            // 서버에서 기존 피드백을 보존하도록 처리하거나, 필요 시 폼에 피드백 필드 추가.
            // 여기서는 팝업에서 입력된 값만으로 업데이트.
            const checkInData = { 작성자: author, 일자: date, 구분: category, 내용: content, 상태: status }; 
            
            const payload = { 
                entryId: window.editingCheckInEntryID, // EntryID로 업데이트
                rowIndex: window.editingCheckInRowIndex, // rowIndex도 전달 (서버에서 둘 다 사용 가능)
                data: checkInData 
            };
            const response = await sendRequest('updateCheckIn', payload);

            if (response.status === 'success') {
                showInfoPopup(response.message || 'Check-in이 수정되었습니다.');
                closePopup('editCheckInPopup');
                if(document.getElementById('checkInPage').style.display === 'block') loadCheckInData();
                if(document.getElementById('dashboardPage').style.display === 'block') loadDashboardData();
            } else {
                showInfoPopup('Check-in 수정 실패: ' + (response.message || '알 수 없는 오류'));
            }
            window.editingCheckInEntryID = null; // 작업 후 초기화
            window.editingCheckInRowIndex = null;
        }

        // handleDeleteCheckInFromEditPopup 함수 (필요시 구현)
        // async function handleDeleteCheckInFromEditPopup() { ... }
    </script>

    <div id="loginPage" class="page">
        <div class="login-box">
            <h2>에이치엘비셀<br> 업무관리시스템</h2>
            <input type="text" id="loginId" placeholder="ID">
            <input type="password" id="loginPassword" placeholder="Password">
            <button class="login-button" onclick="handleLogin()">로그인</button>
            <button class="new-account-button" onclick="openNewAccountPopup()">신규 계정 생성</button>
        </div>
    </div>

    <div id="dashboardPage" class="page container">
        <div class="header">
            <div>
                <h2>Dashboard</h2>
                <div class="user-info"><span></span></div>
            </div>
            <div class="buttons">
                <button class="refresh-button" onclick="loadDashboardData()">새로고침</button>
                <button class="nav-button" onclick="showPage('dashboardPage')">대시보드</button>
                <button class="nav-button" onclick="showPage('checkInPage')">Check-in</button>
                <button class="nav-button" onclick="showPage('purchasePage')">구매관리</button>
                <button class="nav-button" onclick="showPage('expensePage')">개인경비</button>
                <button class="nav-button" id="navButtonAdminPageDashboard" onclick="showPage('adminPage')" style="display:none;">관리자</button>
                </div>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-section">
                <h3>최근 Check-in</h3>
                <table id="dashboardCheckInTable">
                    <thead>
                        <tr>
                            <th>일자</th>
                            <th>내용</th>
                            <th>상태</th>
                            <th>피드백</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardCheckInTableBody"></tbody>
                </table>
                <div class="dashboard-link">
                    <button class="nav-button" onclick="showPage('checkInPage')">Check-in 전체보기 & 작성</button>
                </div>
            </div>
            <div class="dashboard-row">
                <div class="dashboard-section">
                    <h3>최근 구매관리</h3>
                    <table id="dashboardPurchaseTable">
                        <thead>
                            <tr>
                                <th>계산서일자</th>
                                <th>물품명</th>
                                <th>합계</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardPurchaseTableBody"></tbody>
                    </table>
                    <div class="dashboard-link">
                        <button class="nav-button" onclick="showPage('purchasePage')">구매관리 전체보기 & 작성</button>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>최근 개인경비</h3>
                    <table id="dashboardExpenseTable">
                        <thead>
                            <tr>
                                <th>일자</th>
                                <th>적요</th>
                                <th>합계</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardExpenseTableBody"></tbody>
                    </table>
                    <div class="dashboard-link">
                        <button class="nav-button" onclick="showPage('expensePage')">개인경비 전체보기 & 작성</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// Dashboard 데이터 표시 함수 (개선된 버전)
function displayDashboardSummary(response, tableBodyId, headersToDisplay) {
    const tableBody = document.getElementById(tableBodyId);
    if(!tableBody) return;
    tableBody.innerHTML = '';

    if (response.status === 'success' && response.data && response.data.length > 0) {
        // 서버에서 이미 정렬 및 limit 적용된 데이터를 받는다고 가정 (loadDashboardData에서 limit:10 요청)
        // 따라서 클라이언트 측 slice는 필요 없음.

        response.data.forEach(rowData => { 
            const row = tableBody.insertRow();
            headersToDisplay.forEach((headerKey) => {
                const cell = row.insertCell();
                let cellValue = rowData[headerKey] === undefined || rowData[headerKey] === null ? '' : rowData[headerKey];
                
                if (tableBodyId === 'dashboardCheckInTableBody') {
                    if (headerKey === '일자') cellValue = formatDateToYYYYMMDD(cellValue);
                    if (headerKey === '내용' || headerKey === '피드백') {
                        cell.style.whiteSpace = 'normal';
                        cell.style.wordBreak = 'break-all'; 
                        cell.title = rowData[headerKey]; 
                    }
                } else if (tableBodyId === 'dashboardPurchaseTableBody') {
                    if (headerKey === '세금계산서일자') cellValue = formatDateToYYYYMMDD(cellValue);
                    if (headerKey === '합계') {
                        cellValue = formatNumberWithCommas(cellValue);
                        cell.classList.add('numeric');
                    }
                } else if (tableBodyId === 'dashboardExpenseTableBody') {
                    if (headerKey === '일자') cellValue = formatDateToYYYYMMDD(cellValue);
                    if (headerKey === '합계') {
                        cellValue = formatNumberWithCommas(cellValue);
                        cell.classList.add('numeric');
                    }
                }
                cell.innerText = cellValue;
            });
        });
    } else {
        tableBody.innerHTML = `<tr><td colspan="${headersToDisplay.length}">${response.message || '최근 기록이 없습니다.'}</td></tr>`;
    }
}

// Dashboard 데이터 요청 함수 (개선된 버전)
async function loadDashboardData() {
    if (!loggedInUser) return;
    
    const checkInTbody = document.getElementById('dashboardCheckInTableBody');
    const purchaseTbody = document.getElementById('dashboardPurchaseTableBody');
    const expenseTbody = document.getElementById('dashboardExpenseTableBody');

    if(checkInTbody) checkInTbody.innerHTML = '<tr><td colspan="4">로딩 중...</td></tr>';
    if(purchaseTbody) purchaseTbody.innerHTML = '<tr><td colspan="3">로딩 중...</td></tr>';
    if(expenseTbody) expenseTbody.innerHTML = '<tr><td colspan="3">로딩 중...</td></tr>';
    
    const payloadWithLimit = { limit: 5 }; // 서버에 10개 데이터 요청

    const checkInResponse = await sendRequest('getCheckInData', payloadWithLimit); 
    displayDashboardSummary(checkInResponse, 'dashboardCheckInTableBody', ['일자', '내용', '상태', '피드백']);

    const purchaseResponse = await sendRequest('getPurchaseData', payloadWithLimit);
    displayDashboardSummary(purchaseResponse, 'dashboardPurchaseTableBody', ['세금계산서일자', '물품명', '합계']);

    const expenseResponse = await sendRequest('getExpenseData', payloadWithLimit);
    displayDashboardSummary(expenseResponse, 'dashboardExpenseTableBody', ['일자', '적요', '합계']);
}
</script>

    <div id="purchasePage" class="page container">
        <div class="header">
            <div>
                <h2>구매관리</h2>
                <div class="user-info"><span></span></div>
            </div>
            <div class="buttons">
                <button class="action-button" onclick="openNewEntryPopup('purchase')">신규 작성</button>
                <button class="refresh-button" onclick="loadPurchaseData()">새로고침</button>
                <button class="nav-button" onclick="showPage('dashboardPage')">대시보드</button>
                <button class="nav-button" onclick="showPage('checkInPage')">Check-in</button>
                <button class="nav-button" onclick="showPage('purchasePage')">구매관리</button>
                <button class="nav-button" onclick="showPage('expensePage')">개인경비</button>
            </div>
        </div>
        <div class="data-section">
            <table id="purchaseTable">
                <thead><tr><th>담당자</th><th>구매구분</th><th>프로젝트</th><th>국책과제여부</th><th>구매품의번호</th><th>구매품의명</th><th>품의서링크</th><th>구매처</th><th>물품명</th><th>단가</th><th>수량</th><th>공급가</th><th>부가세</th><th>합계</th><th>세금계산서일자</th><th>비고</th><th>증빙</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="expensePage" class="page container">
        <div class="header">
            <div>
                <h2>개인경비관리</h2>
                <div class="user-info"><span></span></div>
            </div>
            <div class="buttons">
                <button class="action-button" onclick="openNewEntryPopup('expense')">신규 작성</button>
                <button class="refresh-button" onclick="loadExpenseData()">새로고침</button>
                <button class="nav-button" onclick="showPage('dashboardPage')">대시보드</button>
                <button class="nav-button" onclick="showPage('checkInPage')">Check-in</button>
                <button class="nav-button" onclick="showPage('purchasePage')">구매관리</button>
                <button class="nav-button" onclick="showPage('expensePage')">개인경비</button>
            </div>
        </div>
        <div class="data-section">
            <table id="expenseTable">
                <thead><tr><th>담당자</th><th>일자</th><th>비목</th><th>사용처</th><th>적요</th><th>공급가</th><th>부가세</th><th>합계</th><th>비고</th><th>증빙</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="checkInPage" class="page container">
        <div class="header">
            <div>
                <h2>Check-in!!</h2>
                <div class="user-info"><span></span></div>
            </div>
            <div class="buttons">
                <button class="action-button" onclick="openCheckInPopup()">신규 작성</button> <button class="refresh-button" onclick="loadCheckInData()">새로고침</button>
                <button class="nav-button" onclick="showPage('dashboardPage')">대시보드</button>
                <button class="nav-button" onclick="showPage('checkInPage')">Check-in</button>
                <button class="nav-button" onclick="showPage('purchasePage')">구매관리</button>
                <button class="nav-button" onclick="showPage('expensePage')">개인경비</button>
            </div>
        </div>
        <div class="data-section">
            <table id="checkInTable">
                <thead><tr><th>작성자</th><th>일자</th><th>구분</th><th>내용</th><th>상태</th><th>피드백</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="checkInPopup" class="popup-overlay">
        <div class="popup-content"> <h3>새로운 Check-in 작성</h3>
            <form id="checkInPopupForm">
                <div class="form-group"><label for="popupCheckInEntryAuthor">작성자:</label><input type="text" id="popupCheckInEntryAuthor" name="작성자" readonly></div>
                <div class="form-group"><label for="popupCheckInEntryDate">일자:</label><input type="date" id="popupCheckInEntryDate" name="일자"></div>
                <div class="form-group"><label for="popupCheckInEntryCategory">구분:</label>
                    <select id="popupCheckInEntryCategory" name="구분">
                        <option value="업무">업무</option><option value="요청">요청</option><option value="일상">일상</option><option value="기분">기분</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group"><label for="popupCheckInEntryStatus">상태:</label>
                    <select id="popupCheckInEntryStatus" name="상태">
                        <option value="Great">Great</option><option value="Good">Good</option><option value="Okay" selected>Okay</option><option value="No Good">No Good</option><option value="Poor">Poor</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label for="popupCheckInEntryContent">내용:</label>
                    <textarea id="popupCheckInEntryContent" name="내용" rows="4"></textarea> </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveCheckInFromPopup()">SAVE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('checkInPopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editCheckInPopup" class="popup-overlay">
        <div class="popup-content"> <h3>Check-in 수정</h3> <form id="editCheckInPopupForm">
                <div class="form-group"><label for="editCheckInEntryAuthor">작성자:</label><input type="text" id="editCheckInEntryAuthor" name="작성자" readonly></div>
                <div class="form-group"><label for="editCheckInEntryDate">일자:</label><input type="date" id="editCheckInEntryDate" name="일자"></div>
                <div class="form-group"><label for="editCheckInEntryCategory">구분:</label>
                    <select id="editCheckInEntryCategory" name="구분">
                        <option value="업무">업무</option><option value="요청">요청</option><option value="일상">일상</option><option value="기분">기분</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group"><label for="editCheckInEntryStatus">상태:</label>
                    <select id="editCheckInEntryStatus" name="상태">
                        <option value="Great">Great</option><option value="Good">Good</option><option value="Okay">Okay</option> <option value="No Good">No Good</option><option value="Poor">Poor</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label for="editCheckInEntryContent">내용:</label>
                    <textarea id="editCheckInEntryContent" name="내용" rows="4"></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveCheckInFromEditPopup()">SAVE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('editCheckInPopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="adminPage" class="page container">
        <div class="header">
            <div>
                <h2>관리자 페이지</h2>
                <div class="user-info"><span></span></div>
            </div>
            <div class="buttons">
                <button class="action-button admin-create-button" onclick="openNewAccountPopup()">계정 생성</button>
                <button class="refresh-button" onclick="loadAccountData()">계정 새로고침</button>
                <button class="nav-button" onclick="showPage('dashboardPage')">대시보드</button>
                <button class="nav-button" onclick="showPage('checkInPage')">Check-in</button>
                <button class="nav-button" onclick="showPage('purchasePage')">구매관리</button>
                <button class="nav-button" onclick="showPage('expensePage')">개인경비</button>
                </div>
        </div>
        <div class="data-section">
            <table id="accountTable">
                <thead><tr><th>ID</th><th>password</th><th>소속</th><th>성명</th><th>직급</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="newUserPopup" class="popup-overlay">
        <div class="popup-content">
            <h3>신규계정 생성</h3>
            <form id="newUserPopupForm"> <div class="form-group"><label for="newAccountId">ID:</label><input type="text" id="newAccountId" name="ID" required></div>
                <div class="form-group"><label for="newUserPassword">Password:</label><input type="password" id="newUserPassword" name="password" required></div>
                <div class="form-group"><label for="newUserAffiliation">소속:</label><input type="text" id="newUserAffiliation" name="소속"></div>
                <div class="form-group"><label for="newUserName">성명:</label><input type="text" id="newUserName" name="성명" required></div>
                <div class="form-group"><label for="newUserPosition">직급:</label><input type="text" id="newUserPosition" name="직급"></div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleCreateNewAccount()">SAVE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('newUserPopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="newPurchasePopup" class="popup-overlay">
        <div class="popup-content">
            <h3>신규 구매항목 작성</h3>
            <form id="newPurchasePopupForm">
                <div class="form-group"><label for="newPurchase_담당자">담당자:</label><input type="text" id="newPurchase_담당자" name="담당자" readonly></div>
                <div class="form-group">
                    <label for="newPurchase_구매구분">구매구분:</label>
                    <select id="newPurchase_구매구분" name="구매구분">
                        <option value="재료">재료</option><option value="장비">장비</option><option value="비품">비품</option><option value="소모품">소모품</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newPurchase_프로젝트">프로젝트:</label>
                    <select id="newPurchase_프로젝트" name="프로젝트">
                        <option value="세포외기질">세포외기질</option><option value="지혈제">지혈제</option><option value="인공간">인공간</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newPurchase_국책과제여부">국책과제여부:</label>
                    <select id="newPurchase_국책과제여부" name="국책과제여부"><option value="일반">일반</option><option value="국책과제">국책과제</option></select>
                </div>
                <div class="form-group"><label for="newPurchase_구매품의번호">구매품의번호:</label><input type="text" id="newPurchase_구매품의번호" name="구매품의번호"></div>
                <div class="form-group"><label for="newPurchase_구매품의명">구매품의명:</label><input type="text" id="newPurchase_구매품의명" name="구매품의명"></div>
                <div class="form-group"><label for="newPurchase_품의서링크">품의서링크:</label><input type="text" id="newPurchase_품의서링크" name="품의서링크"></div>
                <div class="form-group"><label for="newPurchase_구매처">구매처:</label><input type="text" id="newPurchase_구매처" name="구매처"></div>
                <div class="form-group"><label for="newPurchase_물품명">물품명:</label><input type="text" id="newPurchase_물품명" name="물품명"></div>
                <div class="form-group"><label for="newPurchase_단가">단가:</label><input type="text" id="newPurchase_단가" name="단가"></div>
                <div class="form-group"><label for="newPurchase_수량">수량:</label><input type="text" id="newPurchase_수량" name="수량"></div>
                <div class="form-group"><label for="newPurchase_공급가">공급가:</label><input type="text" id="newPurchase_공급가" name="공급가"></div>
                <div class="form-group"><label for="newPurchase_부가세">부가세:</label><input type="text" id="newPurchase_부가세" name="부가세"></div>
                <div class="form-group"><label for="newPurchase_합계">합계:</label><input type="text" id="newPurchase_합계" name="합계" readonly></div>
                <div class="form-group"><label for="newPurchase_세금계산서일자">세금계산서일자:</label><input type="date" id="newPurchase_세금계산서일자" name="세금계산서일자"></div>
                <div class="form-group"><label for="newPurchase_비고">비고:</label><input type="text" id="newPurchase_비고" name="비고"></div>
                <div class="form-group">
                    <label for="newPurchase_증빙">증빙:</label>
                    <div class="upload-button-group">
                        <input type="text" id="newPurchase_증빙" name="증빙">
                        <button type="button" onclick="openUploadFolder('https://drive.google.com/drive/folders/1kOGLuw3IMCot0VtjCM5AP0uGKDSW8dm9?usp=sharing')">업로드</button>
                    </div>
                </div>
                <div class="popup-instructions">
                    <p>구매증빙 파일명: 일자_거래처명_담당자명 (예: 250509_한국은행_정래호)</p>
                    <p>증빙 업로드 후 해당파일 우클릭 &gt; 공유 &gt; 링크복사 후 링크를 증빙입력란에 입력바랍니다.</p>
                </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveData('purchase')">SAVE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('newPurchasePopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editPurchasePopup" class="popup-overlay">
        <div class="popup-content">
            <h3>구매항목 수정/삭제</h3>
            <form id="editPurchasePopupForm">
                <div class="form-group"><label>담당자:</label><input type="text" name="담당자" readonly></div>
                <div class="form-group"><label>구매구분:</label>
                    <select name="구매구분">
                        <option value="재료">재료</option><option value="장비">장비</option><option value="비품">비품</option><option value="소모품">소모품</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group"><label>프로젝트:</label>
                    <select name="프로젝트">
                        <option value="세포외기질">세포외기질</option><option value="지혈제">지혈제</option><option value="인공간">인공간</option><option value="기타">기타</option>
                    </select>
                </div>
                 <div class="form-group"><label>국책과제여부:</label>
                    <select name="국책과제여부"><option value="일반">일반</option><option value="국책과제">국책과제</option></select>
                </div>
                <div class="form-group"><label>구매품의번호:</label><input type="text" name="구매품의번호"></div>
                <div class="form-group"><label>구매품의명:</label><input type="text" name="구매품의명"></div>
                <div class="form-group"><label>품의서링크:</label><input type="text" name="품의서링크"></div>
                <div class="form-group"><label>구매처:</label><input type="text" name="구매처"></div>
                <div class="form-group"><label>물품명:</label><input type="text" name="물품명"></div>
                <div class="form-group"><label>단가:</label><input type="text" name="단가"></div>
                <div class="form-group"><label>수량:</label><input type="text" name="수량"></div>
                <div class="form-group"><label>공급가:</label><input type="text" name="공급가"></div>
                <div class="form-group"><label>부가세:</label><input type="text" name="부가세"></div>
                <div class="form-group"><label>합계:</label><input type="text" name="합계" readonly></div>
                <div class="form-group"><label>세금계산서일자:</label><input type="date" name="세금계산서일자"></div>
                <div class="form-group"><label>비고:</label><input type="text" name="비고"></div>
                <div class="form-group">
                    <label>증빙:</label>
                    <div class="upload-button-group">
                        <input type="text" name="증빙">
                        <button type="button" onclick="openUploadFolder('https://drive.google.com/drive/folders/1kOGLuw3IMCot0VtjCM5AP0uGKDSW8dm9?usp=sharing')">업로드</button>
                    </div>
                </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveData('purchase')">SAVE</button>
                    <button type="button" class="delete-button" onclick="handleDeleteConfirmation('purchase')">DELETE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('editPurchasePopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="newExpensePopup" class="popup-overlay">
        <div class="popup-content">
            <h3>신규 개인경비 작성</h3>
            <form id="newExpensePopupForm">
                <div class="form-group"><label for="newExpense_담당자">담당자:</label><input type="text" id="newExpense_담당자" name="담당자" readonly></div>
                <div class="form-group"><label for="newExpense_일자">일자:</label><input type="date" id="newExpense_일자" name="일자"></div>
                <div class="form-group">
                    <label for="newExpense_비목">비목:</label>
                    <select id="newExpense_비목" name="비목">
                        <option value="여비교통비">여비교통비</option><option value="복리후생비">복리후생비</option><option value="소모품비">소모품비</option><option value="지급수수료">지급수수료</option><option value="통신비">통신비</option><option value="운반비">운반비</option><option value="접대비">접대비</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group"><label for="newExpense_사용처">사용처:</label><input type="text" id="newExpense_사용처" name="사용처"></div>
                <div class="form-group"><label for="newExpense_적요">적요:</label><input type="text" id="newExpense_적요" name="적요"></div>
                <div class="form-group"><label for="newExpense_공급가">공급가:</label><input type="text" id="newExpense_공급가" name="공급가"></div>
                <div class="form-group"><label for="newExpense_부가세">부가세:</label><input type="text" id="newExpense_부가세" name="부가세"></div>
                <div class="form-group"><label for="newExpense_합계">합계:</label><input type="text" id="newExpense_합계" name="합계" readonly></div>
                <div class="form-group"><label for="newExpense_비고">비고:</label><input type="text" id="newExpense_비고" name="비고"></div>
                <div class="form-group">
                    <label for="newExpense_증빙">증빙:</label>
                    <div class="upload-button-group">
                        <input type="text" id="newExpense_증빙" name="증빙">
                        <button type="button" onclick="openUploadFolder('https://drive.google.com/drive/folders/1VJhUETiHdxF7wRifLrVljeIhP2lVnHVJ?usp=sharing')">업로드</button>
                    </div>
                </div>
                <div class="popup-instructions">
                    <p>경비증빙 파일명: 일자_해당월 개인경비_담당자명 (예: 250509_2025년05월 개인경비_정래호)</p>
                    <p>증빙 업로드 후 해당파일 우클릭 &gt; 공유 &gt; 링크복사 후 링크를 증빙입력란에 입력바랍니다.</p>
                </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveData('expense')">SAVE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('newExpensePopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editExpensePopup" class="popup-overlay">
        <div class="popup-content">
            <h3>개인경비 수정/삭제</h3>
            <form id="editExpensePopupForm">
                <div class="form-group"><label>담당자:</label><input type="text" name="담당자" readonly></div>
                <div class="form-group"><label>일자:</label><input type="date" name="일자"></div>
                <div class="form-group"><label>비목:</label>
                     <select name="비목">
                        <option value="여비교통비">여비교통비</option><option value="복리후생비">복리후생비</option><option value="소모품비">소모품비</option><option value="지급수수료">지급수수료</option><option value="통신비">통신비</option><option value="운반비">운반비</option><option value="접대비">접대비</option><option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group"><label>사용처:</label><input type="text" name="사용처"></div>
                <div class="form-group"><label>적요:</label><input type="text" name="적요"></div>
                <div class="form-group"><label>공급가:</label><input type="text" name="공급가"></div>
                <div class="form-group"><label>부가세:</label><input type="text" name="부가세"></div>
                <div class="form-group"><label>합계:</label><input type="text" name="합계" readonly></div>
                <div class="form-group"><label>비고:</label><input type="text" name="비고"></div>
                <div class="form-group">
                    <label>증빙:</label>
                    <div class="upload-button-group">
                        <input type="text" name="증빙">
                        <button type="button" onclick="openUploadFolder('https://drive.google.com/drive/folders/1VJhUETiHdxF7wRifLrVljeIhP2lVnHVJ?usp=sharing')">업로드</button>
                    </div>
                </div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveData('expense')">SAVE</button>
                    <button type="button" class="delete-button" onclick="handleDeleteConfirmation('expense')">DELETE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('editExpensePopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editAccountPopup" class="popup-overlay">
        <div class="popup-content">
            <h3>계정정보 수정/삭제</h3>
            <form id="editAccountPopupForm"> <div class="form-group"><label for="editAccount_ID">ID:</label><input type="text" id="editAccount_ID" name="ID" readonly></div>
                <div class="form-group"><label for="editAccount_password">Password:</label><input type="password" id="editAccount_password" name="password" placeholder="새 비밀번호 (변경 시에만 입력)"></div>
                <div class="form-group"><label for="editAccount_소속">소속:</label><input type="text" id="editAccount_소속" name="소속"></div>
                <div class="form-group"><label for="editAccount_성명">성명:</label><input type="text" id="editAccount_성명" name="성명"></div>
                <div class="form-group"><label for="editAccount_직급">직급:</label><input type="text" id="editAccount_직급" name="직급"></div>
                <div class="button-group">
                    <button type="button" class="save-button" onclick="handleSaveAccountData()">SAVE</button>
                    <button type="button" class="delete-button" onclick="handleDeleteConfirmationForAccount()">DELETE</button>
                    <button type="button" class="cancel-button" onclick="closePopup('editAccountPopup')">CANCEL</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirmDeletePopup" class="popup-overlay">
        <div class="popup-content" style="max-width: 450px;"> <h3>삭제 확인</h3>
            <p id="confirmDeleteMessage" style="margin-top: 10px; margin-bottom: 20px; line-height: 1.6;"></p>
            <div class="button-group">
                <button type="button" id="confirmDeleteOkButton" class="delete-button">확인</button>
                <button type="button" id="confirmDeleteCancelButton" class="cancel-button">취소</button>
            </div>
        </div>
    </div>

    <div id="infoPopup" class="popup-overlay">
        <div class="popup-content" style="max-width: 450px;">
            <h3>알림</h3>
            <p id="infoPopupMessage" style="margin-top: 10px; margin-bottom: 20px; line-height: 1.6;"></p>
            <div class="button-group">
                <button type="button" id="infoPopupOkButton" class="save-button" onclick="closePopup('infoPopup')">확인</button>
            </div>
        </div>
    </div>

</body>
</html>
